user = postfix
password = PASSWORD
hosts = localhost
dbname = vboxadm
query = /* virtual_alias_maps.cf */ SELECT goto FROM aliases AS a LEFT JOIN domains AS d ON a.domain_id = d.id WHERE d.name = '%d' AND a.local_part = '%u' AND a.is_active AND d.is_active UNION SELECT CONCAT(local_part,'@',domain) AS goto FROM role_accounts WHERE name = '%u' AND NOT (local_part = '%u' AND domain = '%d') UNION SELECT CONCAT(ma.local_part,'@',d.name) FROM mailboxes AS ma LEFT JOIN domains AS d ON ma.domain_id = d.id WHERE ma.local_part = '%u' AND d.name = '%d' UNION SELECT CONCAT(ma.local_part,'@',d.name) As goto FROM mailboxes AS ma LEFT JOIN domains AS d ON ma.domain_id = d.id WHERE NOT EXISTS (SELECT goto FROM aliases AS a LEFT JOIN domains AS d ON a.domain_id = d.id WHERE d.name = '%d' AND a.local_part = '%u' AND a.is_active AND d.is_active UNION SELECT CONCAT(ma1.local_part,'@',d.name) FROM mailboxes AS ma1 LEFT JOIN domains AS d1 ON ma1.domain_id = d1.id WHERE (ma1.local_part = '%u' AND d1.name = '%d')) AND ma.catchall=1 AND d.name='%d'
